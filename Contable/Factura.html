<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Factura SAT</title>
  <!-- Bootstrap CSS -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
  <style>
    body {
      background: #f8f9fa;
      font-size: 14px;
    }
    .invoice-box {
      background: #fff;
      padding: 40px;
      border: 1px solid #dee2e6;
      border-radius: 8px;
      max-width: 850px;
      margin: auto;
      min-height: 1100px; /* tama√±o carta aproximado */
    }
    .invoice-header {
      border-bottom: 2px solid #0d6efd;
      margin-bottom: 20px;
      padding-bottom: 10px;
    }
    .invoice-footer {
      border-top: 2px solid #0d6efd;
      margin-top: 20px;
      padding-top: 10px;
      text-align: center;
      font-size: 12px;
      color: #6c757d;
    }
    .table th {
      background: #e9ecef;
    }
    .logo {
      max-height: 80px;
    }
  </style>
</head>
<body>
  <div class="invoice-box">
    <!-- Encabezado -->
    <div class="invoice-header d-flex justify-content-between align-items-center">
      <div>
        <img src="https://github.com/Jhonylux1999/Ultranet/blob/main/logo%20ultranet.png?raw=true" alt="ULTRANET" class="logo">
      </div>
      <div class="text-end">
        <h5>ULTRANET</h5>
        <p>NIT: 106394967</p>
        <p>7 CALLE, ZONA 2, USPANTAN, QUICHE</p>
      </div>
    </div>
<!-- Datos Fiscales -->
<h6 class="mt-3 fw-bold text-primary">Datos Fiscales</h6>
<table class="table table-sm table-bordered">
  <tr>
    <th class="fw-bold">DTE:</th><td id="DTE"></td>

    <!--<th class="fw-bold">Fecha Certificacion:</th><td id="Certificacion"></td>-->

  </tr>
  <tr>
    <th class="fw-bold">Serie:</th><td id="Serie"></td>
        <th class="fw-bold">Fecha Emision:</th><td id="FechaEmision"></td>

  </tr>
  <!--
<tr>
      <th class="fw-bold">Fecha Certificacion:</th><td id="Certificacion"></td>

</tr>
-->
  <tr>
    <th class="fw-bold">N√∫mero de Autorizaci√≥n:</th>
    <td colspan="3" id="numeroAutorizacion" style="word-break: break-word;"></td>
  </tr>
</table>

<!-- Datos del Cliente -->
<h6 class="mt-3 fw-bold text-primary">Datos del Cliente</h6>
<table class="table table-sm table-bordered">
  <tr>
    <th class="fw-bold">Cliente:</th><td id="Cliente"></td>
    <th class="fw-bold">NIT:</th><td id="nitCliente"></td>
  </tr>
  <tr>
    <th class="fw-bold">Direcci√≥n:</th><td colspan="3" id="Direccion"></td>
  </tr>
</table>

    <!-- Detalle de productos -->
    <table class="table table-bordered" id="tablaProductos">
      <thead>
        <tr>
          <th>Descripcion</th>
          <th>Cantidad</th>
          <th>Precio Unitario</th>
          <th>Total</th>
        </tr>
      </thead>
      <tbody>
        
      </tbody>
    </table>
    </div>

    <!-- Pie -->
   
  
<div class="invoice-footer">
  <p>Factura emitida conforme a las disposiciones de la SAT Guatemala</p>
  <p>Gracias por su compra</p>
  <p class="text-muted" style="font-size: 11px;">
    Desarrollado por Grupo MayaT√©ch |Tel:+502 4086-2520
  </p>
</div>



  </div>


  <script>
    function poblarDatos() {
        
      // Recuperar productos
      let productos = JSON.parse(localStorage.getItem('Productos')) || [];
      let cuerpoTabla = document.querySelector("#tablaProductos tbody");

      productos.forEach(p => {
        let fila = document.createElement("tr");
        fila.innerHTML = `
          <td>${p.Descripcion}</td>
          <td>${p.Cantidad}</td>
          <td>Q${p.PrecioUnitario}</td>
          <td>Q${p.Total}</td>
        `;
        cuerpoTabla.appendChild(fila);
      });
      // üîπ Calcular el total general 
      let totalGeneral = productos.reduce((suma, p) => suma + p.Total, 0); 
      // üîπ Crear fila de total 
      let filaTotal = document.createElement("tr"); filaTotal.innerHTML = ` <td colspan="3" style="text-align:right; font-weight:bold;">TOTAL</td> <td style="font-weight:bold;">Q${totalGeneral}</td> `;
      cuerpoTabla.appendChild(filaTotal);
    }

    
    function encabezado(){
        let Nombrecliente = localStorage.getItem("nombrereceptor");
        let Nit = localStorage.getItem("NitReceptor");
        let FechaEmision = localStorage.getItem("Fecha_Emision");
        let DTE = localStorage.getItem("DTE");
        let serieAutorizacion = localStorage.getItem("SerieAutorizacion");
        let numeroAutorizacion = localStorage.getItem("NumeroAutorizacion");
        let FechaCertificacion = localStorage.getItem("Fecha_Certificacion");
console.log("Certificaci√≥n:", DTE);


        document.getElementById("FechaEmision").textContent = ConvertirFecha_ISO8601Emision(FechaEmision);
        document.getElementById("Cliente").textContent = Nombrecliente;
        document.getElementById("nitCliente").textContent = Nit ;
        document.getElementById("DTE").textContent = DTE;
        document.getElementById("Serie").textContent = serieAutorizacion;
        document.getElementById("numeroAutorizacion").textContent = numeroAutorizacion;

    }


function ConvertirFecha_ISO8601Emision(fecha) {
    let fechaObj = new Date(fecha);

    // Obtener partes de la fecha
    let dia = fechaObj.getDate().toString().padStart(2, "0");
    let mes = (fechaObj.getMonth() + 1).toString().padStart(2, "0"); // meses van de 0 a 11
    let anio = fechaObj.getFullYear();

    // Obtener hora en formato 24h
    let horas = fechaObj.getHours().toString().padStart(2, "0");
    let minutos = fechaObj.getMinutes().toString().padStart(2, "0");
    let segundos = fechaObj.getSeconds().toString().padStart(2, "0");

    // Construir formato deseado
    let fechaLegible = `${dia}/${mes}/${anio} ${horas}:${minutos}:${segundos}`;

    return fechaLegible;
}


    encabezado();
    window.onload = poblarDatos;
  </script>


</body>
</html>
